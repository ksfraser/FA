25d24
< 		simple_page_mode(true);
87,92d85
< 		$this->tabs[] = array( 'title' => 'Variable Products Master SKUs', 'action' => 'create_woo_prod_variable_master_form', 'form' => 'create_woo_product_variable_master_form', 'hidden' => FALSE );
< 		$this->tabs[] = array( 'title' => 'Variable Products Variables', 'action' => 'create_woo_prod_variable_variables_form', 'form' => 'create_woo_product_variable_variables_form', 'hidden' => FALSE );
< 		$this->tabs[] = array( 'title' => 'Variable Products Variables Values', 'action' => 'create_woo_prod_variables_values_form', 'form' => 'create_woo_product_variables_values_form', 'hidden' => FALSE );
< 		$this->tabs[] = array( 'title' => 'Variable Products SKU Combos', 'action' => 'create_woo_prod_variable_sku_combos_form', 'form' => 'create_woo_product_variable_sku_combos_form', 'hidden' => FALSE );
< 		$this->tabs[] = array( 'title' => 'Variable Products ALL SKU Combos', 'action' => 'create_woo_prod_variable_sku_full_form', 'form' => 'create_woo_product_variable_sku_full_form', 'hidden' => FALSE );
< 
112,139d104
< 	function eventloop( $event, $method )
< 	{
< 	}
< 	function eventregister( $event, $method )
< 	{
< 	}
< 	/*******************************************************************************************//**
< 	 *fix_stock_id_size
< 	 *
< 	 *	Because of variation products (have attributes such as size and color) where 
< 	 *	everything else is the same, we want mostly human readable SKUs so that we
< 	 *	can easily type them in without having to hunt for them.  This requires longer
< 	 *	SKU lengths.  Default of 20 doesn't work for us anymore.
< 	 *
< 	 *	This function alters all of the tables (that we know of) to have the longer
< 	 *	length.  The Length is defined in an include file where we are putting
< 	 *	lengths so we can do this to other tables as needed too.
< 	 *
< 	 * **********************************************************************************************/
< 	function fix_stock_id_size()
< 	{
< 		require_once( '../ksf_modules_common/defines.inc.php' );
< 		if( include_once( '../ksf_data_dictionary/class.ksf_data_dictionary.php' ) )
< 		{
< 			$dd = new ksf_data_dictionary( $this->host, $this->user, $this->pass, $this->database, $this->pref_tablename, $this );
< 			$dd->fix_stock_id_size();
< 		}
< 	}
142d106
< 		$this->fix_stock_id_size();
144,145d107
< 		$this->create_table_woo_prod_variable_sku_combos();
< 		$this->create_table_woo_prod_variable_sku_full();
208,211d169
< 		require_once( 'class.woo_prod_variation_attributes.php' );
< 		$category_xref_address = new woo_prod_variation_attributes($this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		if( $category_xref_address->create_table() )
< 			$createdcount++;
225,281c183,193
< 		require_once( 'class.woo_prod_variable_master.php' );
< 		$wpvm = new woo_prod_variable_master( $this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->create_table(); 
< 	}
< 	function create_woo_product_variable_master_form()
< 	{
< 		require_once( 'class.woo_prod_variable_master.php' );
< 		$wpvm = new woo_prod_variable_master($this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->master_form();
< 	}
< 	function create_table_woo_prod_variable_sku_full()
< 	{
< 		require_once( 'class.woo_prod_variable_sku_full.php' );
< 		$wpvm = new woo_prod_variable_sku_full( $this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->create_table(); 
< 	}
< 	function create_woo_product_variable_sku_full_form()
< 	{
< 		require_once( 'class.woo_prod_variable_sku_full.php' );
< 		$wpvm = new woo_prod_variable_sku_full($this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->master_form();
< 	}
< 	function create_table_woo_prod_variable_sku_combos()
< 	{
< 		require_once( 'class.woo_prod_variable_sku_combos.php' );
< 		$wpvm = new woo_prod_variable_sku_combos( $this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->create_table(); 
< 	}
< 	function create_woo_product_variable_sku_combos_form()
< 	{
< 		require_once( 'class.woo_prod_variable_sku_combos.php' );
< 		$wpvm = new woo_prod_variable_sku_combos($this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->master_form();
< 	}
< 	function create_table_woo_prod_variable_variables()
< 	{
< 		require_once( 'class.woo_prod_variable_variables.php' );
< 		$wpvm = new woo_prod_variable_variables( $this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->create_table(); 
< 	}
< 	function create_woo_product_variable_variables_form()
< 	{
< 		require_once( 'class.woo_prod_variable_variables.php' );
< 		$wpvm = new woo_prod_variable_variables($this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->master_form();
< 	}
< 	function create_table_woo_prod_variables_values()
< 	{
< 		require_once( 'class.woo_prod_variables_values.php' );
< 		$wpvm = new woo_prod_variables_values( $this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->create_table(); 
< 	}
< 	function create_woo_product_variables_values_form()
< 	{
< 		require_once( 'class.woo_prod_variables_values.php' );
< 		$wpvm = new woo_prod_variables_values($this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
< 		$wpvm->master_form();
---
> 		$table_details = array();
> 		$fields_array = array();
> 		$fields_array[] = array('name' => 'id_woo_prod_variable_master', 'type' => 'int(11)', 'auto_increment' => 'TRUE' );
> 		$fields_array[] = array('name' => 'stock_id', 'type' => 'varchar(32)' );
> 		$fields_array[] = array('name' => 'updated_ts', 'type' => 'timestamp', 'null' => 'NOT NULL', 'default' => 'CURRENT_TIMESTAMP');
> 		//$table_details['tablename'] = TB_PREF . "woo_categories_xref";
> 		$table_details['tablename'] = $this->company_prefix . "woo_prod_variable_master";
> 		//$table_details['primarykey'] = "fa_cat";
> 		$table_details['index'][0] = array( 'name' => "idx_stock_id", 'columns' => "stock_id" );
> 
> 		$this->create_table( $table_details, $fields_array );
297a210,237
> 	function create_table_woo_prod_variable_variables()
> 	{
> 		$table_details = array();
> 		$fields_array = array();
> 		$fields_array[] = array('name' => 'id_woo_prod_variable_variables', 'type' => 'int(11)', 'auto_increment' => 'TRUE' );
> 		$fields_array[] = array('name' => 'variablename', 'type' => 'varchar(32)' );
> 		$fields_array[] = array('name' => 'updated_ts', 'type' => 'timestamp', 'null' => 'NOT NULL', 'default' => 'CURRENT_TIMESTAMP');
> 		//$table_details['tablename'] = TB_PREF . "woo_categories_xref";
> 		$table_details['tablename'] = $this->company_prefix . "woo_prod_variable_variables";
> 
> 		$this->create_table( $table_details, $fields_array );
> 	}
> 		function create_table_woo_prod_variables_values()
> 	{
> 		$table_details = array();
> 		$fields_array = array();
> 		$fields_array[] = array('name' => 'id_woo_prod_variables_values', 'type' => 'int(11)', 'auto_increment' => 'TRUE' );
> 		$fields_array[] = array('name' => 'variablename', 'type' => 'varchar(32)' );
> 		$fields_array[] = array('name' => 'value', 'type' => 'varchar(32)' );
> 		$fields_array[] = array('name' => 'slug', 'type' => 'varchar(32)' );
> 		$fields_array[] = array('name' => 'updated_ts', 'type' => 'timestamp', 'null' => 'NOT NULL', 'default' => 'CURRENT_TIMESTAMP');
> 		//$table_details['tablename'] = TB_PREF . "woo_categories_xref";
> 		$table_details['tablename'] = $this->company_prefix . "woo_prod_variables_values";
> 		$table_details['index'][0] = array( 'name' => "idx_variables_values", 'columns' => "variablename, value" );
> 		$table_details['foreign'][0] = array( 'column' => "variablename", 'foreigntable' => "woo_prod_variable_variables", "foreigncolumn" => "variablename", "on_update" => "restrict", "on_delete" => "restrict" );
> 
> 		$this->create_table( $table_details, $fields_array );
> 	}
300,301c240
< 		require_once( 'class.woo_coupons.php' );
< 		$coupons = new woo_coupons( $this->woo_server, $this->woo_ck, $this->woo_cs, null, $this );
---
> 		$coupons = new woo_coupons();
406d344
< 		label_row(_("Product is inactive (e.g. duplicate or depreciated)"), NULL);
501,504d438
< 
< 		$res = db_query( "select count(*) from " . TB_PREF . "qoh", "Couldn't count QOH" );
< 		$count = db_fetch_row( $res );
< 		$oldcount = $count[0];
533,536c467
<             	display_notification("$count[0] rows of items exist in qoh.  Added " . $oldcount - $count[0]);
< 		$res = db_query( "select count(*) from " . TB_PREF . "stock_master where inactive='0'", "Couldn't count QOH" );
< 		$count = db_fetch_row( $res );
<             	display_notification("$count[0] rows of active items exist in stock_master.");
---
>             	display_notification("$count[0] rows of items exist.");
593,597c524
< 		$sql_update2a = "update " . TB_PREF . "woo woo
< 			set
< 				woo.price = '0'
< 			where woo.price is null";
< 		$res = db_query( $sql_update2a, "Couldnt update NULL prices in  WOO" );
---
> 
603,612d529
< 
< 		$sql_update4 = "update " . TB_PREF . "woo woo
< 			set
< 				woo.date_on_sale_to = '2015-01-01'";
< 		$res = db_query( $sql_update4, "Couldnt invalidate Sales and Specials in  WOO" );
< 		$sql_update4a = "update " . TB_PREF . "woo woo
< 			set
< 				woo.sale_price = woo.price
< 			";
< 		$res = db_query( $sql_update4a, "Couldnt set sales prices to prices in WOO" );
1452d1368
< 
