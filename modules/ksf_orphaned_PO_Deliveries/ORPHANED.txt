Receiving a bunch of items into inventory, I discovered that items are showing received on their product ITEMS tab, but clicking on the link to the delivery does not show the item in that list.  In addition, many items were not showing up to be invoiced in the Supplier Invoice.  

My guess is that there was a time-out on the SQL Inserts, that these were not done as an ATOMIC transaction and so only part of the steps occured.
Code does show having a BEGIN and COMMIT db transaction - MySql needs to be using InnoDB tables for the row locking for these to work 

delivery 168 - brooch-brighid-goddess

This module is to go find the orphaned items, and complete the missing steps.



Receiving:
	process_receive_po()			//po_receive_items.php
		add_grn( &$_SESSION['PO'] )	//purchasing\includes\db\grn_db.inc
			--db_query "BEGIN"
			add_grn_batch
			add_grn_detail_item
			add_stock_move 		//includes/db/inventory_db.inc
			--db_query "COMMIT"
			

add_grn_batch
	INSERT INTO ".TB_PREF."grn_batch (purch_order_no, delivery_date, supplier_id, reference, loc_code)
			VALUES (".db_escape($po_number).", ".db_escape($date).", "
			.db_escape($supplier_id).", ".db_escape($reference).", ".db_escape($location).")"



add_grn_detail_item
	UPDATE ".TB_PREF."purch_order_details
        SET quantity_received = quantity_received + ".db_escape($quantity_received).",
        std_cost_unit=".db_escape($standard_unit_cost).",
        quantity_ordered=".db_escape($quantity).",
        act_price=".db_escape($price)."
        WHERE po_detail_item = ".db_escape($po_detail_item)

	INSERT INTO ".TB_PREF."grn_items (grn_batch_id, po_detail_item, item_code, description, qty_recd)
		VALUES (".db_escape($grn_batch_id).", "
		.db_escape($po_detail_item).", ".db_escape($item_code).", ".db_escape($description)
		.", ".db_escape($quantity_received).")




add_stock_move
	INSERT INTO ".TB_PREF."stock_moves (stock_id, trans_no, type, loc_code,
		tran_date, person_id, reference, qty, standard_cost, visible, price,
		discount_percent) VALUES (".db_escape($stock_id)
		.", ".db_escape($trans_no).", ".db_escape($type)
		.",	".db_escape($location).", '$date', "
		.db_escape($person_id).", ".db_escape($reference).", "
		.db_escape($quantity).", ".db_escape($std_cost).","
		.db_escape($show_or_hide).", "
		.db_escape($price).", ".db_escape($discount_percent).")"

