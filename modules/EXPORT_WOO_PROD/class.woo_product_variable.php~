<?php

/*******************************************
 * If you change the list of properties below, ensure that you also modify
 * build_write_properties_array
 * */

require_once( 'class.woo_product.php' );

class woo_product_variable extends woo_product {
	
	function __construct( $serverURL, $woo_rest_path,
				$key, $secret, $enviro = "devel", $client = null; )
	{
		parent::__construct($serverURL, $woo_rest_path, $key, $secret, $enviro = "devel", $client = null;);
		return;
	}
	function create_product()
	{
		/*
		 * 	WORKS!!  NOTE must be https.  http returns you aren't allowed to create resources...
		 * 	curl -X POST --insecure https://fhsws001.ksfraser.com/devel/fhs/wordpress/wp-json/wc/v1/products 
		 * 	-u ck_b23355fc0b9ee8b1ae073b64538ce4217f7530b3:cs_54b294848a424eff342ce5d7918dd17f122b0b56 
		 * 	-H "Content-Type: application/json" 
		 * 	-d '{ "name": "Premium Quality", "type": "simple", "regular_price": "21.99", "description": "Pellentesque ...",  "short_description": "Pellentesque ..." }'
		 */
		
		$this->build_data_array();
		try {
			$this->data_array['title'] = $this->name;
			$this->wc_client->products->create( $this->data_array );
			//print_r( $response );
			//$this->extract_data_obj( $response->product );
			//var_dump( $this->id );
			//echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
			//var_dump( $response );
		} catch ( WC_API_Client_Exception $e ) {
			//echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
			//echo $e->getMessage() . PHP_EOL;
			//echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
			//echo $e->getCode() . PHP_EOL;
			if ( $e instanceof WC_API_Client_HTTP_Exception ) {
				//var_dump( $e );
				$code = $e->getCode();
				//echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
				//var_dump( $code );
				$msg = $e->getMessage();
				//echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
				//var_dump( $msg );
				switch( $code ){
				case    "woocommerce_rest_product_sku_already_exists":
						echo "<br />" . __FILE__ . ":" . __LINE__ . "SKU " . $this->sku . " Exists<br />";
						$this->get_product_by_sku( $this->sku );
						$this->update_wootable_woodata();	
						//We should go  update...
					break;
					case	"woocommerce_api_product_sku_already_exists":
					case 400:	//"woocommerce_api_product_sku_already_exists"
					//	echo "<br />" . __FILE__ . ":" . __LINE__ . "SKU " . $this->sku . " Exists<br />";
						$this->get_product_by_sku( $this->sku );
						$this->update_wootable_woodata();	
					//	echo "<br />" . __FILE__ . ":" . __LINE__ . "SKU " . $this->sku . " Exists<br />";
						$woop = $this->client->woo2wooproduct( $this->sku );
					//	echo "<br />" . __FILE__ . ":" . __LINE__ . "SKU " . $this->sku . " Exists<br />";
						$woop->id = $this->id;
						echo "<br />" . __FILE__ . ":" . __LINE__ . "SKU " . $this->sku . " Exists<br />";
						$woop->update_product();
					break;
				default:
					break;
				}
			}
		}
	
		return;
	}
	function retrieve_product()
	{
		/*
		curl https://example.com/wp-json/wc/v1/products/162 -u consumer_key:consumer_secret
		 * 
		 * */
	}
	function update_product()
	{
		/*
		curl -X PUT https://example.com/wp-json/wc/v1/products/162  -u consumer_key:consumer_secret  -H "Content-Type: application/json"  -d '{ "regular_price": "24.54" }'
		 * 
		 * */
			
		$this->build_data_array();
		try {
			$this->data_array['title'] = $this->name;
			$this->wc_client->products->update( $this->id, $this->data_array );
		} catch ( WC_API_Client_Exception $e ) {
			echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
			echo $e->getMessage() . PHP_EOL;
			echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
			echo $e->getCode() . PHP_EOL;
			if ( $e instanceof WC_API_Client_HTTP_Exception ) {
				echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
				print_r( $e->get_request() );
				echo "<br />" . __FILE__ . ":" . __LINE__ . "<br />";
				print_r( $e->get_response() );
			}
		}
		return;
	}
}

?>
